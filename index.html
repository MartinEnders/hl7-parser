<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Hl7-parser by MartinEnders</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Hl7-parser</h1>
        <p class="header">Common Lisp HL7 Parser (encoder / decoder)</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/MartinEnders/hl7-parser/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/MartinEnders/hl7-parser/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/MartinEnders/hl7-parser">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/MartinEnders">MartinEnders</a></p>


      </header>
      <section>
        <h1>
<a id="common-lisp-hl7-parser" class="anchor" href="#common-lisp-hl7-parser" aria-hidden="true"><span class="octicon octicon-link"></span></a>Common Lisp HL7-Parser</h1>

<p>HL7-Parser for HL7 Version 2 Messages (decode / encode) for Common Lisp.</p>

<blockquote>
<p>The HL7 Version 2 Messaging Standard — Application Protocol for Electronic
Data Exchange in Healthcare Environments — is considered to be the workhorse
of data exchange in healthcare and is the most widely implemented standard
for healthcare information in the world.</p>
</blockquote>

<p>Source: <a href="http://www.hl7.org/about/FAQs/index.cfm?ref=nav">http://www.hl7.org/about/FAQs/index.cfm?ref=nav</a> ("General HL7 FAQ" &gt; "Version 2" &gt; "What is Version 2?")</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p><a href="http://opensource.org/licenses/BSD-3-Clause">http://opensource.org/licenses/BSD-3-Clause</a></p>

<h2>
<a id="implementation" class="anchor" href="#implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation</h2>

<p>SBCL and CCL on Debian GNU/Linux</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>HL7-Parser is 'quickloadable':</p>

<div class="highlight highlight-source-lisp"><pre>(ql:quickload <span class="pl-s"><span class="pl-pds">"</span>hl7-parser<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<div class="highlight highlight-source-lisp"><pre>(<span class="pl-k">defun</span> <span class="pl-en">decode</span> (string-<span class="pl-k">or</span>-stream)</pre></div>

<p>hl7-parser:decode</p>

<ul>
<li>decode: Accepts a String or a Stream containing HL7-Messages</li>
<li>returns a list of parsed messages.</li>
</ul>

<div class="highlight highlight-source-lisp"><pre>(<span class="pl-k">defun</span> <span class="pl-en">encode</span> (message-list &amp;key (delimiter <span class="pl-s"><span class="pl-pds">"</span>|^~<span class="pl-cce">\\</span>&amp;<span class="pl-pds">"</span></span>) (message-delimiter <span class="pl-c1">nil</span>))</pre></div>

<p>hl7-parser:encode</p>

<ul>
<li>
<code>message-list</code> List of decoded HL7-Messages</li>
<li>
<code>delimiter</code> for encoding of Message</li>
<li>
<code>message-delimiter</code> if true then the encoded Messages ends with a <code>#\Newline</code> if nil then no <code>#\Newline</code> is appended (default nil).</li>
<li>returns a list of encoded messages (Strings)</li>
</ul>

<div class="highlight highlight-source-lisp"><pre>(<span class="pl-k">defun</span> <span class="pl-en">test-parser</span> (in-file out-file &amp;key (external-format :iso-<span class="pl-c1">8859</span>-<span class="pl-c1">1</span>) (output-delimiters <span class="pl-s"><span class="pl-pds">"</span>|^~<span class="pl-cce">\\</span>&amp;<span class="pl-pds">"</span></span>))</pre></div>

<p>hl7-test:test-parser</p>

<ul>
<li>Read <code>in-file</code> (with HL7-messages) decode every line and then encode it and write it to <code>out-file</code>.</li>
<li>Use <code>diff in-file out-file</code> to check if the encode and decode of the messages work.</li>
<li>returns always <code>NIL</code>
</li>
</ul>

<h2>
<a id="exeptionhandling-and-validation" class="anchor" href="#exeptionhandling-and-validation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exeptionhandling and validation</h2>

<p>Every String or Stream with at least eight Characters is parsed in a more or less reasonable way.</p>

<p>There are no syntax or HL7-Structure checking mechanisms.</p>

<h2>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h2>

<div class="highlight highlight-source-lisp"><pre>CL-USER&gt; (hl7-parser:decode (<span class="pl-c1">format</span> <span class="pl-c1">nil</span> <span class="pl-s"><span class="pl-pds">"</span>MSH|^~~<span class="pl-cce">\\</span>&amp;|test|test^test|~cEVN||123~c~c<span class="pl-pds">"</span></span> <span class="pl-c1">#\Return</span> <span class="pl-c1">#\Return</span> <span class="pl-c1">#\Newline</span> ))
((:MESSAGE
  (:SEGMENT (:FIELD <span class="pl-s"><span class="pl-pds">"</span>MSH<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>|^~<span class="pl-cce">\\</span>&amp;<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span> (:COMPONENT <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>) <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
   (:FIELD <span class="pl-s"><span class="pl-pds">"</span>EVN<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>123<span class="pl-pds">"</span></span>) <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)))

CL-USER&gt; (hl7-parser:encode (hl7-parser:decode (<span class="pl-c1">format</span> <span class="pl-c1">nil</span> <span class="pl-s"><span class="pl-pds">"</span>MSH|^~~<span class="pl-cce">\\</span>&amp;|test|test^test|~cEVN||123~c~c<span class="pl-pds">"</span></span> <span class="pl-c1">#\Return</span> <span class="pl-c1">#\Return</span> <span class="pl-c1">#\Newline</span> )))
(<span class="pl-s"><span class="pl-pds">"</span>MSH|^~<span class="pl-cce">\\</span>&amp;|test|test^test|^MEVN||123^M<span class="pl-pds">"</span></span>) <span class="pl-c">; ^M -&gt; #\Return</span>

CL-USER&gt; (hl7-parser:encode (hl7-parser:decode (<span class="pl-c1">format</span> <span class="pl-c1">nil</span> <span class="pl-s"><span class="pl-pds">"</span>MSH|^~~<span class="pl-cce">\\</span>&amp;|test|test^test|~cEVN||123~c~c<span class="pl-pds">"</span></span> <span class="pl-c1">#\Return</span> <span class="pl-c1">#\Return</span> <span class="pl-c1">#\Newline</span> )) :message-delimiter <span class="pl-c1">t</span>)
(<span class="pl-s"><span class="pl-pds">"</span>MSH|^~<span class="pl-cce">\\</span>&amp;|test|test^test|^MEVN||123^M</span>
<span class="pl-s"><span class="pl-pds">"</span></span>) <span class="pl-c">; ^M -&gt; #\Return</span></pre></div>

<p>How to set Delimiters for encoding:</p>

<div class="highlight highlight-source-lisp"><pre>CL-USER&gt; (hl7-parser:decode (<span class="pl-c1">format</span> <span class="pl-c1">nil</span> <span class="pl-s"><span class="pl-pds">"</span>MSH#^~~<span class="pl-cce">\\</span>&amp;#test#test^test#~c<span class="pl-pds">"</span></span> <span class="pl-c1">#\Newline</span> ))
((:MESSAGE (:FIELD <span class="pl-s"><span class="pl-pds">"</span>MSH<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>#^~<span class="pl-cce">\\</span>&amp;<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span> (:COMPONENT <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span> <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>) <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)))

CL-USER&gt; (hl7-parser:encode (hl7-parser:decode (<span class="pl-c1">format</span> <span class="pl-c1">nil</span> <span class="pl-s"><span class="pl-pds">"</span>MSH|^~~<span class="pl-cce">\\</span>&amp;|test|test^test|~c<span class="pl-pds">"</span></span> <span class="pl-c1">#\Newline</span> )) :delimiter <span class="pl-s"><span class="pl-pds">"</span>#^~<span class="pl-cce">\\</span>&amp;<span class="pl-pds">"</span></span>)
(<span class="pl-s"><span class="pl-pds">"</span>MSH#^~<span class="pl-cce">\\</span>&amp;#test#test^test#<span class="pl-pds">"</span></span>)</pre></div>

<p>Pay attention to the character escaping (~ in format directive and backslashes)</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
